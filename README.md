# Лабораторная работа: Управление контейнерами с помощью LXC/LXD на Ubuntu

## Цель работы

Изучить работу с контейнерами в системе LXD, включая установку, конфигурацию, запуск контейнеров, управление сетевыми мостами, проброс портов и использование снапшотов.

## Установка и настройка LXD

LXD был установлен через snap-пакет. Для этого выполнены следующие действия:

```bash
sudo apt update
sudo snap install lxd
sudo apt install lxc
```

## Инициализация LXD

Выполнена первичная настройка с помощью команды `lxd init` со следующими параметрами:

- Кластеринг: нет
- Создание storage pool: да
- Название storage pool: default
- Тип хранилища: dir
- Подключение к MAAS: нет
- Создание мостового интерфейса: да
- Название моста: lxdbr0
- IPv4: auto
- IPv6: auto
- Сетевой доступ к LXD: да
- IP-адрес: all
- Порт: 8443
- Обновление образов: да
- Вывод YAML-конфига: нет

## Запуск контейнера

Первая попытка запуска контейнера:

```bash
lxc launch images:ubuntu/20.04 my-container
```

Привела к ошибке: образ не найден. Были проверены доступные образы:

```bash
lxc image list images: ubuntu
```

Для запуска использован источник `ubuntu:` вместо `images:`:

```bash
lxc launch ubuntu:20.04 my-container
```

![image](https://github.com/user-attachments/assets/9a0eefc2-6c18-4640-98e3-c09b2555d428)

Контейнер успешно создан и получил IP-адрес через мост `lxdbr0`.

Проверка - подключение к контейнеру `lxc exec my-container -- bash`:

![image](https://github.com/user-attachments/assets/d23fee3e-78d3-4a3e-a85e-5a4b51d7a544)

## Настройка моста

В ходе инициализации был создан мост `lxdbr0`, который:

- Позволяет контейнерам получать IP-адреса через встроенный DHCP
- Даёт контейнерам доступ к интернету через NAT
- Обеспечивает связь между контейнерами внутри моста

Проверка IP-адреса контейнера:

```bash
lxc list
```

![image](https://github.com/user-attachments/assets/2953582f-9000-4760-bc86-1fe114f3e706)

У меня был 10.198.101.36

## Проброс портов

Был настроен проброс порта с хоста на контейнер. Пример:

```bash
lxc config device add my-container myport80 proxy listen=tcp:0.0.0.0:8080 connect=tcp:127.0.0.1:80
```
Вывод должен быть: `Device myport80 added to my-conteiner`.

После этого можно было получить доступ к веб-серверу внутри контейнера по адресу:

```
http://localhost:8080
```
В моем случае я не настраивал веб-сервер.

## Работа со снапшотами

Создание снапшота перед изменениями:

```bash
lxc snapshot my-container snap1
```
Проверка `lxc info my-container`:

![image](https://github.com/user-attachments/assets/ba6da317-61f2-41af-a9fe-7c8ec2d2a91d)

Восстановление контейнера из снапшота:

```bash
lxc restore my-container snap1
```

Удаление снапшота:

```bash
lxc delete my-container/snap1
```

## Выводы

В ходе лабораторной работы была развёрнута LXD-среда на Ubuntu. Проведена инициализация с настройкой хранилища и сетевого моста. Запущен контейнер на основе Ubuntu 20.04, реализован проброс портов с хоста внутрь контейнера, выполнены операции создания и восстановления снапшотов. Получен практический опыт работы с lxc-lxd контейнерами.
